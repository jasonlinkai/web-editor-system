# syntax=docker/dockerfile:1
FROM node:18-alpine

ARG MYSQL_DATABASE_HOST
ARG MYSQL_DATABASE_PORT
ARG MYSQL_DATABASE_DATABASE
ARG MYSQL_DATABASE_USERNAME
ARG MYSQL_DATABASE_PASSWORD
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_SECRET_REGION
ARG GOOGLE_OAUTH2_SECRET
ARG GOOGLE_OAUTH2_CLIENT_ID
ARG JWT_SECRET
ARG CLIENT_URL
ARG SERVER_HOST
ARG PORT

ENV MYSQL_DATABASE_HOST=$MYSQL_DATABASE_HOST
ENV MYSQL_DATABASE_PORT=$MYSQL_DATABASE_PORT
ENV MYSQL_DATABASE_DATABASE=$MYSQL_DATABASE_DATABASE
ENV MYSQL_DATABASE_USERNAME=$MYSQL_DATABASE_USERNAME
ENV MYSQL_DATABASE_PASSWORD=$MYSQL_DATABASE_PASSWORD
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV AWS_SECRET_REGION=$AWS_SECRET_REGION
ENV GOOGLE_OAUTH2_SECRET=$GOOGLE_OAUTH2_SECRET
ENV GOOGLE_OAUTH2_CLIENT_ID=$GOOGLE_OAUTH2_CLIENT_ID
ENV JWT_SECRET=$JWT_SECRET
ENV CLIENT_URL=$CLIENT_URL
ENV SERVER_HOST=$SERVER_HOST
ENV PORT=$PORT

WORKDIR /usr/app
COPY . .
RUN yarn install
RUN yarn build
EXPOSE 3001
CMD ["yarn", "start"]
